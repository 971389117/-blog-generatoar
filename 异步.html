<script>
    // 1.new Promise后立即执行回调
    // 2.回调中，如果执行resolve， then中将执行第一个函数
    // 3.回调中，如果执行reject， then中将执行第二个函数

    // Promise 对象有两个特点
    // 1.对象的状态不受外界影响
    //      Promise代表一个一步操作，有三种状态 pending(进行中),fulfilled（已成功）,rejected
    //      resolve代表fulfilled  reject代表 失败
    // 2.一旦状态改变，就不会再变（凝固）
    let promise = new Promise(function (resolve, reject) {
        console.log('Promise')
        resolve('a');
        reject('e', console.log(321))
        console.log('1')
    })
    promise.then(function (a) {
        console.log('resolved   ', a)
    }, function () {
        console.log('13')
    })
    console.log('HI!')




    function loadImageAsync(url) {
        return new Promise(function (resolve, reject) {
            const image = new Image()
            image.onload = function () {

            }
            image.onerror = function () {

            }
            image.src = url
        })
    }


    const getJSON = function (url) {
        const promise = new Promise(function (resolve, reject) {
            const handler = function () {
                if (this.readyState !== 4) {
                    return;
                }
                if (this.status === 200) {
                    resolve(this.response);
                } else {
                    reject(new Error(this.statusText));
                }
            };
            const client = new XMLHttpRequest();
            client.open("GET", url);
            client.onreadystatechange = handler;
            client.responseType = "json";
            client.setRequestHeader("Accept", "application/json");
            client.send();

        });

        return promise;
    };

    getJSON("/posts.json").then(function (json) {
        console.log('Contents: ' + json);
    }, function (error) {
        console.error('出错了', error);
    });
</script>
